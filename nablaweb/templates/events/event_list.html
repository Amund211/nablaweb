{% extends "base.html" %}

{% block title %}Arrangement{% endblock %}

{% block more_head %}
<link rel="alternate" type="application/rss+xml" href="/arrangement/feed/" title="RSS feed">
{% endblock %}

{% block main %}

<!-- calendar row -->
<div class="row">
<div class="span12">

<h2>Kalender {{ calendar.first.year }}</h2>

<table class="calendar">

    <caption> 

        <div class="pagination pagination-centered">
            <ul>
                <li>
                    <a href="{% url event_list calendar.prev.year calendar.prev.month %}">&laquo;</a>
                </li>
                <li class="inactive"><a>{{ calendar.first|date:"F"|capfirst }}</a></li>
                <li>
                    <a href="{% url event_list calendar.next.year calendar.next.month %}">&raquo;</a>
                </li>
            </ul>
        </div>

    </caption>

    <thead>
        <tr>
            <th class="uke">Uke</th>
            <th>Man</th>
            <th>Tir</th>
            <th>Ons</th>
            <th>Tor</th>
            <th>Fre</th>
            <th>Lør</th>
            <th>Søn</th>
        </tr>
    </thead>

    <tbody>
        {% for week in calendar.weeks %}
        <tr>
            <td>{{ week.weeknumber }}</td>
            {% for day in week.days %}
            <td class="cell
                    {% if day.differentmonth %} differentmonth {% endif %}
                    {% if day.current %} current {% endif %}
                ">

                
                <ul class="events">
                    <li class="date"><b>{{ day.date }}.</b></li>
                    {% for event in day.events %}
                        <li>
                            <b class="icon-cog"></b>
                            <a href="{{ event.get_absolute_url }}">{{ event.get_short_name }}</a>
                        </li>
                    {% endfor %}
                </ul>
            </td>
            {% endfor %}
        </tr>
        {% endfor %}
    </tbody>

</table>

</div> <!-- end span12 -->
</div><!-- row -->

<div class="row">

    {% if user.is_authenticated %}

        <div class="span4">
            <h2>Påmeldinger</h2>
            <table class="table table-bordered table-striped">

            {% for reg in user.eventregistration_set.all %}
            <tr>
                <td><a href="{{ reg.event.get_absolute_url }}">{{ reg.event.headline }}</a></td>
                <td>
                    {% if reg.is_waiting_place %}
                        På venteliste
                    {% endif %}

                    {% if reg.is_attending_place %}
                        <span class="icon check"></span> Har plass
                    {% endif %}
                </td>
                </td>
            </tr>
            {% empty %}
                <tr><td>Du er ikke meldt på noe</td></tr>
            {% endfor %}

            </table>

        </div>

        <div class="span4">
            <h2>Prikker</h2>
            <p>Om du er påmeldt, men ikke møter opp på arrangement, kan du bli
            straffet i form av prikker. Jo flere prikker, jo lengre må du vente for
            å melde deg på et arrangement.</p>
            {% if penalty_list %}
            <p>Du har {{ penalty_list|length }} prikk{{ penalty_list|length|pluralize:"er" }}:</p>
            <ul>{% for penalty in penalty_list %}<li>{{ penalty.get_display_name }}</li>{% endfor %}</ul>
            {% else %}
            <p>Du har ingen prikker. Godt jobbet!</p>
            {% endif %}
        </div>

        <div class="span4">
            <h2>Masse plass</h2> 
        </div>

    {% else %}

        <div class="span12">
            <p>Logg på for å se hvilke arrangement du er påmeldt.</p>
        </div>

    {% endif %}
</div>

{% endblock main %}
