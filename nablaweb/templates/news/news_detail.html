{% extends "base.html" %}
{% load markup %}
{% load humanize %}
{% load comments %}
{% load mediawiki_links %}
{% load thumbnail %}

{% block morehead %}

<meta property="og:image" content="{{ news.get_picture_url }}" />
<meta property="og:title" content="{{ news.headline|striptags }}" />
<meta property="og:type"  content="article" />
<meta property="og:description" content="{% spaceless %}{{ news.lead_paragraph|striptags }}{% endspaceless %}" />

{% endblock %}

{% block content %}

{% if news.picture %}
    <img alt="header" width="100%" src="{% thumbnail news.picture 770x250 box=news.cropping %}">
{% endif %}

<h2>{{ news.headline }}</h2>
{{ news.lead_paragraph|markdown|wikilinks}}
{{ news.body|markdown|wikilinks}}

{% if news.allow_comments %}
{# Comments #}
    {% get_comment_count for news as comment_count %}

    {% if comment_count > 0 %}
        <h3 class="comments-header">Kommentarer</h3>
    {% endif %}

    {% render_comment_list for news %}

    {% if user.is_authenticated %}
        {% render_comment_form for news %}
    {% else %}
        <p class="well">Logg inn for å skrive en kommentar</p>
    {% endif %}
{# end Comments #}
{% endif %}

{% endblock %}




{% block sidebar %}

{% include "content/includes/meta.html" with content=news %}

<!-- relaterte events -->
<h3>Relaterte arrangement</h3>
{% for event in news.event_set.all %}
    <table class="table table-bordered  table-striped">

    <thead>
        <tr><th colspan="2">{{ event.headline }}</th></tr>
    </thead>

    <tbody>

        <!-- Fra -->
        <tr>
            <td>Starter</td>
            <td>
                <time datetime="{{ event.event_start|date:"c" }}">
                {{ event.event_start|naturalday }} kl. {{ event.event_start|date:"G:i" }}
                </time>
            </td>
        </tr>

        <!-- Til -->
        {% if event.event_end %}
        <tr>
            <td>Slutter</td>
            <td>
                <time datetime="{{ event.event_end|date:"c" }}">
                    {{ event.event_end|naturalday }} kl. {{ event.event_end|date:"G:i" }}
                </time>
            </td>
        </tr>
        {% endif %}

        <!-- Sted -->
        <tr><td>Sted</td><td>{{ event.location }}</td></tr>

        <!-- Registrering åpner -->
        {% if event.registration_start %}
        <tr>
            <td>Registrering åpner</td>
            <td>
                <time datetime="{{ event.registration_start|date:"c" }}">
                    {{ event.registration_start|naturalday }} kl. {{ event.registration_start|date:"G:i" }}
                </time>
            </td>
        </tr>
        {% endif %}

        <tr>
            <td style="text-align: center;" colspan="2">
                {% if event.registration_required %}
                    Påmelding kreves
                {% else %}
                    Påmelding unødvendig
                {% endif %}
            </td>
        </tr>

        {% if event.registration_required %}
        <tr><td colspan="2">
                <div style="margin:0;" class="progress{% if event.percent_full > 90 %} danger{% endif %}">
                    <div class="bar" style="width: {{ event.percent_full }}%;"></div>
                </div>
        </td></tr>
        {% endif %}
    </tbody>

    <tfoot>
        <tr><td colspan="2">
            <a href="{% url event_detail event.id %}" class="btn primary">Les mer</a>
            <a href="#notimplemented" class="btn"><span class="icon-custom icon-facebook"></span> Vis på Facebook</a>
        </td></tr>
    </tfoot>

    </table>
{% endfor %}
<!-- end relaterte events -->

<div class="well" style="padding: 8px 0;">
    <ul class="nav nav-list">
        <li class="nav-header">Admin</li>
        <li><a href="{% url admin:news_news_change news.id %}"><i class="icon-pencil"></i> Endre</a></li>
        <li><a href="{% url admin:news_news_delete news.id %}"><i class="icon-trash"></i> Slett</a></li>
    </ul>
</div>

{% endblock %}
